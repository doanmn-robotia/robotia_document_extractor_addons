<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <!-- Main Dashboard Template -->
    <t t-name="robotia_document_extractor.Dashboard">
        <div class="o_document_extractor_dashboard">
            <div class="dashboard-header">
                <h1><i class="fa fa-file-pdf-o me-2"/>Document Extractor</h1>
                <p class="text-muted">AI-powered extraction for Vietnamese controlled substance reports</p>
            </div>

            <div t-if="state.loading" class="text-center py-5">
                <i class="fa fa-spinner fa-spin fa-3x text-primary"/>
                <p class="mt-3">Loading dashboard...</p>
            </div>

            <div t-else="">
                <!-- Upload Area -->
                <UploadArea
                    onExtractionComplete.bind="onExtractionComplete"
                    onUploadStart.bind="onUploadStart"
                    onUploadEnd.bind="onUploadEnd"
                    disabled="state.uploading"/>

                <!-- Statistics Cards -->
                <div class="statistics-cards mt-4">
                    <StatisticsCard
                        title.translate="Registrations"
                        count="state.statistics.registrations"
                        docType="'01'"
                        onClick.bind="onCardClick"
                        disabled="state.uploading"/>

                    <StatisticsCard
                        title.translate="Reports"
                        count="state.statistics.reports"
                        docType="'02'"
                        onClick.bind="onCardClick"
                        disabled="state.uploading"/>
                </div>

                <!-- Recent Extractions -->
                <div class="mt-4 d-flex gap-4">
                    <RecentExtractions disabled="state.uploading"/>
                    <div class="recent-extractions-container" t-if="state.jobs.length > 0">
                        <div class="section-header">
                            <h2><i class="fa fa-tasks me-2"/>Extraction Jobs</h2>
                        </div>
    
                        <div class="recent-list">
                            <t t-foreach="state.jobs" t-as="job" t-key="job.id">
                                <div class="recent-item"
                                     t-on-click="() => this.onJobClick(job)">
    
                                    <!-- Icon based on queue_state -->
                                    <div class="recent-item-icon">
                                        <i t-if="job.queue_state === 'done'" class="fa fa-check-circle fa-2x text-success"/>
                                        <i t-elif="job.queue_state === 'failed'" class="fa fa-times-circle fa-2x text-danger"/>
                                        <i t-elif="job.queue_state === 'started'" class="fa fa-spinner fa-spin fa-2x text-info"/>
                                        <i t-elif="job.queue_state === 'cancelled'" class="fa fa-ban fa-2x text-muted"/>
                                        <i t-else="" class="fa fa-clock-o fa-2x text-muted"/>
                                    </div>
    
                                    <!-- Content -->
                                    <div class="recent-item-content">
                                        <h4 class="recent-item-title">
                                            <t t-esc="job.name"/>
                                        </h4>
                                        <div class="recent-item-meta">
                                            <!-- Type Badge -->
                                            <span class="me-3">
                                                <span t-if="job.document_type === '01'" class="badge bg-primary">Form 01</span>
                                                <span t-else="" class="badge bg-secondary">Form 02</span>
                                            </span>
    
                                            <!-- Created Date -->
                                            <span class="me-3">
                                                <i class="fa fa-clock-o me-1"/>
                                                <t t-esc="job.create_date"/>
                                            </span>
    
                                            <!-- Progress (if started) -->
                                            <span t-if="job.queue_state === 'started'" class="me-3">
                                                <i class="fa fa-spinner fa-spin me-1"/>
                                                <t t-esc="job.progress"/>% - <t t-esc="job.progress_message"/>
                                            </span>
                                        </div>
                                    </div>
    
                                    <!-- Status Badge -->
                                    <div class="recent-item-badge">
                                        <span t-if="job.queue_state === 'done'" class="badge bg-success">Done</span>
                                        <span t-elif="job.queue_state === 'failed'" class="badge bg-danger">Failed</span>
                                        <span t-elif="job.queue_state === 'started'" class="badge bg-info">Processing</span>
                                        <span t-elif="job.queue_state === 'cancelled'" class="badge bg-secondary">Cancelled</span>
                                        <span t-else="" class="badge bg-warning">Queued</span>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <!-- Show More Button -->
                        <div t-if="state.jobsHasMore" class="text-center mt-3">
                            <button class="btn btn-outline-primary" t-on-click="loadMoreJobs">
                                <i class="fa fa-chevron-down me-2"/>Show More
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Extraction Jobs List -->
            </div>
        </div>
    </t>

    <!-- Upload Area Template -->
    <t t-name="robotia_document_extractor.UploadArea">
        <div class="upload-area-container">
            <div class="upload-area"
                 t-att-class="{
                     'drag-over': state.dragOver,
                     'disabled': props.disabled or state.uploading
                 }"
                 t-on-dragover="onDragOver"
                 t-on-dragleave="onDragLeave"
                 t-on-drop="onDrop">

                <div class="upload-content">
                    <!-- File Preview Card (when file selected) -->
                    <div t-if="state.selectedFile and !state.uploading" class="file-preview-card">
                        <div class="file-preview-header">
                            <i class="fa fa-file-pdf-o fa-2x text-danger"/>
                            <div class="file-preview-info">
                                <h4 class="file-preview-name"><t t-esc="state.filePreview.name"/></h4>
                                <p class="file-preview-size text-muted"><t t-esc="state.filePreview.size"/></p>
                            </div>
                            <button class="btn btn-sm btn-light"
                                    t-on-click="cancelFileSelection"
                                    title="Remove file">
                                <i class="fa fa-times"/>
                            </button>
                        </div>

                        <div class="file-preview-actions mt-3">
                            <button class="btn btn-primary btn-lg w-100"
                                    t-on-click="startExtraction">
                                <i class="fa fa-magic me-2"/>Start Extraction
                            </button>
                        </div>

                        <div class="upload-info mt-3 text-center">
                            <small class="text-muted">
                                <i class="fa fa-info-circle me-1"/>
                                Click the button above to start AI extraction
                            </small>
                        </div>
                    </div>

                    <!-- Upload Area (default state) -->
                    <div t-elif="!state.uploading and !state.selectedFile">
                        <i class="fa fa-cloud-upload fa-4x text-primary"/>
                        <h3 class="mt-3">Drag &amp; Drop PDF File</h3>
                        <p class="text-muted">or click to browse</p>

                        <label class="btn btn-primary btn-lg mt-2">
                            <i class="fa fa-folder-open me-2"/>Browse Files
                            <input type="file"
                                   accept=".pdf,application/pdf"
                                   t-on-change="onFileSelect"
                                   style="display:none"/>
                        </label>

                        <div class="document-type-selector mt-4">
                            <label class="form-label fw-bold">Document Type:</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio"
                                       class="btn-check"
                                       name="documentType"
                                       id="docType01"
                                       value="01"
                                       checked="checked"
                                       t-on-change="onDocumentTypeChange"/>
                                <label class="btn btn-outline-primary" for="docType01">
                                    <i class="fa fa-file-text me-1"/>Form 01 - Registration
                                </label>

                                <input type="radio"
                                       class="btn-check"
                                       name="documentType"
                                       id="docType02"
                                       value="02"
                                       t-on-change="onDocumentTypeChange"/>
                                <label class="btn btn-outline-primary" for="docType02">
                                    <i class="fa fa-bar-chart me-1"/>Form 02 - Report
                                </label>
                            </div>
                        </div>

                        <div class="upload-info mt-3">
                            <small class="text-muted">
                                <i class="fa fa-info-circle me-1"/>
                                Supported format: PDF | Max size: 50MB
                            </small>
                        </div>
                    </div>

                    <!-- Uploading State -->
                    <div t-else="" class="uploading-state text-center py-4">
                        <i class="fa fa-spinner fa-spin fa-3x text-primary"/>
                        <h4 class="mt-3">Extracting Document...</h4>
                        <p class="text-muted">Please wait while AI processes your document</p>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- Statistics Card Template -->
    <t t-name="robotia_document_extractor.StatisticsCard">
        <div class="stat-card"
             t-att-class="{'disabled': props.disabled}"
             t-on-click="handleClick">
            <div class="stat-card-icon">
                <i t-att-class="props.docType === '01' ? 'fa fa-file-text fa-2x' : 'fa fa-bar-chart fa-2x'"/>
            </div>
            <div class="stat-card-content">
                <h3 class="stat-card-title"><t t-esc="props.title"/></h3>
                <div class="stat-card-count"><t t-esc="props.count"/></div>
                <div class="stat-card-footer">
                    <span class="text-muted">
                        <t t-if="props.docType === '01'">Registration forms</t>
                        <t t-else="">Report forms</t>
                    </span>
                </div>
            </div>
        </div>
    </t>

    <!-- Recent Extractions Template -->
    <t t-name="robotia_document_extractor.RecentExtractions">
        <div class="recent-extractions-container">
            <div class="section-header">
                <h2><i class="fa fa-history me-2"/>Recent Extractions</h2>
            </div>

            <div t-if="state.loading" class="text-center py-3">
                <i class="fa fa-spinner fa-spin fa-2x text-muted"/>
            </div>

            <div t-elif="state.recentDocuments.length === 0" class="text-center py-5">
                <i class="fa fa-inbox fa-3x text-muted"/>
                <p class="mt-3 text-muted">No documents extracted yet</p>
            </div>

            <div t-else="" class="recent-list">
                <div t-foreach="state.recentDocuments" t-as="doc" t-key="doc.id"
                     class="recent-item"
                     t-att-class="{'disabled': props.disabled}"
                     t-on-click="() => this.openDocument(doc.id)">

                    <div class="recent-item-icon">
                        <i t-att-class="doc.document_type === '01' ? 'fa fa-file-text-o fa-2x' : 'fa fa-bar-chart fa-2x'"/>
                    </div>

                    <div class="recent-item-content">
                        <h4 class="recent-item-title">
                            <t t-esc="doc.name"/>
                        </h4>
                        <div class="recent-item-meta">
                            <span class="me-3">
                                <i class="fa fa-building-o me-1"/>
                                <t t-esc="doc.organization_id[1]"/>
                            </span>
                            <span class="me-3">
                                <i class="fa fa-calendar me-1"/>
                                <t t-esc="doc.year"/>
                            </span>
                            <span>
                                <i class="fa fa-clock-o me-1"/>
                                <t t-esc="formatDate(doc.extraction_date)"/>
                            </span>
                        </div>
                    </div>

                    <div class="recent-item-badge">
                        <span t-att-class="getStateBadgeClass(doc.state)">
                            <t t-esc="getStateLabel(doc.state)"/>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>

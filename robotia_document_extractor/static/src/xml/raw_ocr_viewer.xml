<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="robotia_document_extractor.RawOCRViewer" owl="1">
        <div class="o_raw_ocr_viewer">
            <!-- No OCR data available -->
            <t t-if="!ocrData">
                <div class="alert alert-info mb-0">
                    <i class="fa fa-info-circle me-2"/>
                    <strong>No OCR data available</strong> - <span>This document was extracted without OCR processing.</span>
                </div>
            </t>

            <!-- OCR data available -->
            <t t-else="">
                <!-- Items List Panel -->
                <div class="ocr-items-panel">
                    <div class="panel-header">
                        <h5 class="mb-0" t-if="state.viewMode === 'items'">OCR Items</h5>
                        <h5 class="mb-0" t-if="state.viewMode === 'preview'">Markdown Preview</h5>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-secondary" t-if="state.viewMode === 'items'">
                                <t t-esc="totalItems"/> items
                            </span>

                            <!-- Back button (preview mode only) -->
                            <button t-if="state.viewMode === 'preview'"
                                    class="btn btn-sm btn-outline-secondary"
                                    t-on-click="togglePreview"
                                    title="Back to items list">
                                <i class="fa fa-arrow-left"/>
                            </button>

                            <!-- Preview button (items mode only) -->
                            <button t-if="state.viewMode === 'items'"
                                    class="btn btn-sm btn-outline-secondary"
                                    t-on-click="togglePreview"
                                    title="Preview markdown">
                                <i class="fa fa-eye"/>
                            </button>

                            <!-- Download button (always visible) -->
                            <button class="btn btn-sm btn-outline-secondary"
                                    t-on-click="onDownloadMarkdown"
                                    title="Download all markdown content">
                                <i class="fa fa-download"/>
                            </button>
                        </div>
                    </div>

                    <!-- Items List View -->
                    <div class="items-list" t-if="state.viewMode === 'items'">
                        <t t-foreach="pages" t-as="pageData" t-key="pageData.page">
                            <div class="page-section">
                                <!-- Page header (clickable to expand/collapse) -->
                                <div class="page-header" 
                                     t-on-click="() => this.togglePage(pageData.page)"
                                     t-att-class="{ 'expanded': isPageExpanded(pageData.page) }">
                                    <i t-att-class="isPageExpanded(pageData.page) ? 'fa fa-chevron-down' : 'fa fa-chevron-right'"/>
                                    <i class="fa fa-file-o ms-1"/>
                                    <span class="page-title">Page <t t-esc="pageData.page"/></span>
                                    <span class="badge bg-light text-dark ms-auto"><t t-esc="pageData.items.length"/></span>
                                </div>
                                
                                <!-- Page items (shown when expanded) -->
                                <div class="page-items" t-if="isPageExpanded(pageData.page)">
                                    <t t-if="pageData.items.length === 0">
                                        <div class="text-muted text-center py-2" style="font-size: 12px;">
                                            No items on this page
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <t t-foreach="pageData.items" t-as="item" t-key="item_index">
                                            <div class="item-card"
                                                 t-att-class="{ 'selected': state.selectedItem === item }"
                                                 t-on-click="() => this.selectItem(item, pageData.page)">
                                                <div class="item-header">
                                                    <i t-att-class="getItemIcon(item.type)" class="me-1"/>
                                                    <span class="item-type-label" t-esc="item.type"/>
                                                </div>
                                                <div class="item-preview">
                                                    <!-- Show markdown for tables, plain text for others -->
                                                    <t t-if="item.type === 'table' and state.markedLoaded">
                                                        <div class="markdown-preview" t-out="renderMarkdown(item.md || item.value)"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span t-esc="getItemPreview(item)"/>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </t>
                    </div>

                    <!-- Markdown Preview View -->
                    <div class="markdown-preview-panel" t-if="state.viewMode === 'preview'">
                        <t t-if="!state.markedLoaded or !allMarkdown">
                            <div class="alert alert-warning m-3">
                                <i class="fa fa-exclamation-triangle me-2"/>
                                <span>No markdown content available or markdown library not loaded.</span>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="markdown-content" t-out="renderMarkdown(allMarkdown)"/>
                        </t>
                    </div>
                </div>
            </t>
        </div>
    </t>
</templates>

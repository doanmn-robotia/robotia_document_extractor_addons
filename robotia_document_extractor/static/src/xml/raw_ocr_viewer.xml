<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="robotia_document_extractor.RawOCRViewer" owl="1">
        <div class="o_raw_ocr_viewer">
            <!-- No OCR data available -->
            <t t-if="!ocrData">
                <div class="alert alert-info mb-0">
                    <i class="fa fa-info-circle me-2"/>
                    <strong>No OCR data available</strong> - <span>This document was extracted without OCR processing.</span>
                </div>
            </t>

            <!-- OCR data available -->
            <t t-else="">
                <!-- Items List Panel -->
                <div class="ocr-items-panel">
                    <div class="panel-header">
                        <h5 class="mb-0">OCR Items</h5>
                        <span class="badge bg-secondary"><t t-esc="totalItems"/> items</span>
                    </div>
                    
                    <div class="items-list">
                        <t t-foreach="pages" t-as="pageData" t-key="pageData.page">
                            <div class="page-section">
                                <!-- Page header (clickable to expand/collapse) -->
                                <div class="page-header" 
                                     t-on-click="() => this.togglePage(pageData.page)"
                                     t-att-class="{ 'expanded': isPageExpanded(pageData.page) }">
                                    <i t-att-class="isPageExpanded(pageData.page) ? 'fa fa-chevron-down' : 'fa fa-chevron-right'"/>
                                    <i class="fa fa-file-o ms-1"/>
                                    <span class="page-title">Page <t t-esc="pageData.page"/></span>
                                    <span class="badge bg-light text-dark ms-auto"><t t-esc="pageData.items.length"/></span>
                                </div>
                                
                                <!-- Page items (shown when expanded) -->
                                <div class="page-items" t-if="isPageExpanded(pageData.page)">
                                    <t t-if="pageData.items.length === 0">
                                        <div class="text-muted text-center py-2" style="font-size: 12px;">
                                            No items on this page
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <t t-foreach="pageData.items" t-as="item" t-key="item_index">
                                            <div class="item-card"
                                                 t-att-class="{ 'selected': state.selectedItem === item }"
                                                 t-on-click="() => this.selectItem(item, pageData.page)">
                                                <div class="item-header">
                                                    <i t-att-class="getItemIcon(item.type)" class="me-1"/>
                                                    <span class="item-type-label" t-esc="item.type"/>
                                                </div>
                                                <div class="item-preview">
                                                    <!-- Show markdown for tables, plain text for others -->
                                                    <t t-if="item.type === 'table' and state.markedLoaded">
                                                        <div class="markdown-preview" t-out="renderMarkdown(item.md || item.value)"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span t-esc="getItemPreview(item)"/>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </div>
    </t>
</templates>

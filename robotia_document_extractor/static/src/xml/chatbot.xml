<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <!-- ChatBot Main Template -->
    <t t-name="robotia_document_extractor.ChatBot">
        <div class="chatbot-dashboard-page">
            <div class="page">
                <!-- Header -->
                <div class="header">
                    <div>
                        <div class="header-title">Tr·ª£ l√Ω AI</div>
                        <div class="header-sub">H·ªó tr·ª£ tr√≠ch xu·∫•t v√† ph√¢n t√≠ch t√†i li·ªáu t·ª± ƒë·ªông</div>
                    </div>
                    <button
                        t-if="state.messages.length > 0"
                        class="btn btn-outline-primary new-chat-btn"
                        t-on-click="startNewChat">
                        <i class="fa fa-plus-circle"/> T·∫°o ƒëo·∫°n chat m·ªõi
                    </button>
                </div>

                <!-- Chat Container -->
                <div class="chat-container">
                    <!-- Chat Messages Area -->
                    <div class="chat-messages" t-ref="chatMessages">
                        <!-- Welcome Screen -->
                        <div t-if="state.messages.length === 0" class="chat-welcome">
                            <div class="welcome-content">
                                <h3>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Tr·ª£ l√Ω AI</h3>
                                <p class="text-muted">H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ tr√≠ch xu·∫•t t√†i li·ªáu, bi·ªÉu m·∫´u ho·∫∑c ph√¢n t√≠ch d·ªØ li·ªáu.</p>
                            </div>

                            <!-- Quick Actions Grid -->
                            <div class="quick-actions-grid">
                                <div class="quick-action-card" t-on-click="() => this.sendQuickAction('H∆∞·ªõng d·∫´n tr√≠ch xu·∫•t M·∫´u 01')">
                                    <div class="quick-action-icon">üìÑ</div>
                                    <h6>H·ªó tr·ª£ M·∫´u 01</h6>
                                    <p>H∆∞·ªõng d·∫´n tr√≠ch xu·∫•t M·∫´u ƒëƒÉng k√Ω</p>
                                </div>
                                <div class="quick-action-card" t-on-click="() => this.sendQuickAction('H∆∞·ªõng d·∫´n tr√≠ch xu·∫•t M·∫´u 02')">
                                    <div class="quick-action-icon">üìä</div>
                                    <h6>H·ªó tr·ª£ M·∫´u 02</h6>
                                    <p>H∆∞·ªõng d·∫´n tr√≠ch xu·∫•t M·∫´u b√°o c√°o</p>
                                </div>
                                <div class="quick-action-card" t-on-click="() => this.sendQuickAction('Xem t√†i li·ªáu g·∫ßn ƒë√¢y')">
                                    <div class="quick-action-icon">üïí</div>
                                    <h6>T√†i li·ªáu g·∫ßn ƒë√¢y</h6>
                                    <p>Xem l·ªãch s·ª≠ tr√≠ch xu·∫•t</p>
                                </div>
                                <div class="quick-action-card" t-on-click="() => this.sendQuickAction('Ch·∫•t ki·ªÉm so√°t l√† g√¨?')">
                                    <div class="quick-action-icon">üß™</div>
                                    <h6>Th√¥ng tin ch·∫•t</h6>
                                    <p>T√¨m hi·ªÉu v·ªÅ ch·∫•t ki·ªÉm so√°t</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages List -->
                        <div t-else="" class="messages-list">
                            <div t-foreach="state.messages" t-as="message" t-key="message.id"
                                 class="message-wrapper"
                                 t-att-class="message.role === 'user' ? 'message-user' : 'message-bot'">

                                <div class="message-bubble">
                                    <div class="message-text">
                                        <t t-esc="message.text"/>
                                    </div>

                                    <!-- Action Button -->
                                    <div t-if="message.action" class="message-action">
                                        <button
                                            class="btn btn-primary btn-sm action-btn"
                                            t-on-click="() => this.executeActionFromButton(message.action)">
                                            <i class="fa fa-external-link-square"/>
                                            <t t-if="message.action.type === 'open_dashboard'">
                                                M·ªü Dashboard
                                            </t>
                                            <t t-elif="message.action.type === 'view_substance'">
                                                Xem Chi Ti·∫øt
                                            </t>
                                            <t t-elif="message.action.type === 'search_documents'">
                                                T√¨m Ki·∫øm
                                            </t>
                                            <t t-elif="message.action.type === 'create_document'">
                                                T·∫°o T√†i Li·ªáu
                                            </t>
                                            <t t-else="">
                                                Th·ª±c Hi·ªán
                                            </t>
                                        </button>
                                    </div>

                                    <div class="message-time">
                                        <t t-esc="formatTime(message.timestamp)"/>
                                    </div>
                                </div>
                            </div>

                            <!-- Typing Indicator -->
                            <div t-if="state.isTyping" class="message-wrapper message-bot">
                                <div class="message-bubble">
                                    <div class="typing-indicator">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input Area -->
                    <div class="chat-input-area">
                        <div class="input-wrapper">
                            <input
                                type="text"
                                class="chat-input"
                                placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n..."
                                t-model="state.inputMessage"
                                t-on-keydown="onInputKeydown"
                                t-att-disabled="state.isTyping"
                                t-ref="chatInput"/>

                            <button
                                class="send-btn"
                                t-on-click="sendMessage"
                                t-att-disabled="state.isTyping or !state.inputMessage.trim()">
                                <i class="fa fa-paper-plane"/>
                            </button>
                        </div>

                        <!-- Suggestions -->
                        <div t-if="state.messages.length > 0 and state.suggestions.length > 0" class="suggestions">
                            <div class="suggestions-chips">
                                <button
                                    t-foreach="state.suggestions"
                                    t-as="suggestion"
                                    t-key="suggestion"
                                    class="suggestion-chip"
                                    t-on-click="() => this.sendQuickAction(suggestion)"
                                    t-att-disabled="state.isTyping">
                                    <t t-esc="suggestion"/>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>

<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="robotia_document_extractor.OverviewDashboard">
        <div class="o_overview_dashboard">
            <!-- Loading State -->
            <div t-if="state.loading" class="loading-state">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="mt-3 text-muted">Đang tải dữ liệu dashboard...</p>
            </div>

            <!-- Error State -->
            <div t-elif="state.error" class="alert alert-danger" role="alert">
                <h4 class="alert-heading">Lỗi khi tải Dashboard</h4>
                <p t-esc="state.error"/>
            </div>

            <!-- Dashboard Content -->
            <div t-else="" class="dashboard-content animate-fade-in">
                <!-- Row 1: 3 KPI Cards - FIXED HEIGHT h-48 (192px) -->
                <div class="row g-4 mb-4">
                    <!-- Card 1: Total Documents -->
                    <div class="col-md-4">
                        <div class="dashboard-card kpi-card">
                            <h6 class="dashboard-card-title">Tổng số tài liệu</h6>
                            <div class="d-flex flex-column justify-content-center h-100">
                                <div class="kpi-number" t-esc="formatNumber(state.kpiData.total_docs, 0)"/>
                                <div class="d-flex gap-3 mt-2 small">
                                    <span class="d-flex align-items-center gap-1">
                                        <span class="status-dot bg-blue"/>
                                        <span class="text-gray-500">Form 01: <strong t-esc="state.kpiData.form01_count"/></span>
                                    </span>
                                    <span class="d-flex align-items-center gap-1">
                                        <span class="status-dot bg-purple"/>
                                        <span class="text-gray-500">Form 02: <strong t-esc="state.kpiData.form02_count"/></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2: Processing Status -->
                    <div class="col-md-4">
                        <div class="dashboard-card kpi-card">
                            <h6 class="dashboard-card-title">Trạng thái xử lý</h6>
                            <div class="status-list">
                                <div class="status-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="status-dot bg-gray"/>
                                        <span class="status-label">Nháp</span>
                                    </div>
                                    <span class="status-count" t-esc="state.kpiData.status_counts.draft"/>
                                </div>
                                <div class="status-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="status-dot bg-orange"/>
                                        <span class="status-label">Đã xác thực</span>
                                    </div>
                                    <span class="status-count" t-esc="state.kpiData.status_counts.validated"/>
                                </div>
                                <div class="status-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="status-dot bg-green"/>
                                        <span class="status-label">Hoàn thành</span>
                                    </div>
                                    <span class="status-count" t-esc="state.kpiData.status_counts.completed"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 3: Recent Activity -->
                    <div class="col-md-4">
                        <div class="dashboard-card kpi-card">
                            <h6 class="dashboard-card-title">Hoạt động gần đây</h6>
                            <div class="activity-list custom-scrollbar">
                                <t t-foreach="state.recentActivity" t-as="activity" t-key="activity.id">
                                    <div class="activity-item" t-att-class="{'border-0': activity_last}">
                                        <span t-if="activity.type === 'approval'" class="status-dot bg-green mt-1"/>
                                        <span t-elif="activity.type === 'report'" class="status-dot bg-purple mt-1"/>
                                        <span t-else="" class="status-dot bg-blue mt-1"/>
                                        <div class="flex-grow-1">
                                            <div class="activity-action" t-esc="activity.action"/>
                                            <div class="activity-meta">
                                                <span t-esc="activity.user"/> • <span t-esc="activity.time"/>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Charts - FIXED HEIGHT h-80 (320px) -->
                <div class="row g-4 mb-4">
                    <!-- Chart 1: Usage by Year (lg:col-span-2) -->
                    <div class="col-lg-8">
                        <div class="dashboard-card chart-card">
                            <h6 class="dashboard-card-title">Lượng khí thải CO₂ theo năm</h6>
                            <div class="chart-container">
                                <canvas t-ref="yearChart"/>
                            </div>
                        </div>
                    </div>

                    <!-- Chart 2: Top Substances (lg:col-span-1) -->
                    <div class="col-lg-4">
                        <div class="dashboard-card chart-card">
                            <h6 class="dashboard-card-title">Top chất phát thải CO₂</h6>
                            <div class="chart-container">
                                <canvas t-ref="substanceChart"/>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Docs by Field + Quick Actions -->
                <div class="row g-4">
                    <!-- Usage by Activity Type (lg:col-span-1) -->
                    <div class="col-lg-4">
                        <div class="dashboard-card h-100">
                            <h6 class="dashboard-card-title">Sử dụng theo loại hoạt động (kg)</h6>
                            <div class="field-list">
                                <t t-foreach="state.activityTypes" t-as="actType" t-key="actType.activity_type">
                                    <div class="field-item">
                                        <span class="field-name" t-esc="actType.activity_label"/>
                                        <span class="field-value" t-esc="formatWeight(actType.total_kg || 0)"/>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions (lg:col-span-2) -->
                    <div class="col-lg-8">
                        <div class="dashboard-card">
                            <h6 class="dashboard-card-title">Thao tác nhanh</h6>
                            <div class="quick-actions-grid">
                                <!-- Upload Button -->
                                <button type="button" class="quick-action-btn btn-blue" t-on-click="onUploadClick">
                                    <i class="fa fa-cloud-upload fa-2x mb-2"/>
                                    <span class="small fw-semibold">Upload</span>
                                </button>

                                <!-- Documents Button -->
                                <button type="button" class="quick-action-btn btn-purple" t-on-click="onDocumentsClick">
                                    <i class="fa fa-list fa-2x mb-2"/>
                                    <span class="small fw-semibold">Tài liệu</span>
                                </button>

                                <!-- Reports Button -->
                                <button type="button" class="quick-action-btn btn-emerald" t-on-click="onReportsClick">
                                    <i class="fa fa-bar-chart fa-2x mb-2"/>
                                    <span class="small fw-semibold">Báo cáo</span>
                                </button>

                                <!-- AI Chat Button -->
                                <button type="button" class="quick-action-btn btn-indigo" t-on-click="onAIChatClick">
                                    <i class="fa fa-comments fa-2x mb-2"/>
                                    <span class="small fw-semibold">AI Trợ lý</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>

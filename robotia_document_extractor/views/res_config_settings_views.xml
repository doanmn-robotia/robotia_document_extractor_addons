<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="res_config_settings_view_form" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.robotia.document.extractor</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="90"/>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="inside">
                <app string="Document Extractor" name="robotia_document_extractor" groups="base.group_system">
                    <block title="AI Configuration">
                        <setting id="gemini_api_key_setting"
                                 help="Configure your Google Gemini API key for AI-powered document extraction">
                            <field name="gemini_api_key" password="True" placeholder="AIza..." class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    Get your API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>
                                </div>
                            </div>
                        </setting>
                        <setting id="gemini_max_output_tokens_setting"
                                 string="Max Output Tokens"
                                 help="Maximum number of tokens for Gemini API response. Increase if extraction fails for very long documents.">
                            <field name="gemini_max_output_tokens" class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    Recommended: 65536 (maximum for Gemini 2.0 Flash). Reduce if you want to limit API costs.
                                </div>
                            </div>
                        </setting>
                    </block>

                    <block title="Document Processing">
                        <setting id="extraction_info_setting" string="Extraction Information">
                            <div class="text-muted">
                                <ul>
                                    <li>Model: Google Gemini 2.0 Flash Exp (with PDF understanding)</li>
                                    <li>Supports Form 01 (Registration) and Form 02 (Report)</li>
                                    <li>Automatic data extraction from Vietnamese PDFs</li>
                                    <li>Human-in-the-loop validation workflow</li>
                                </ul>
                            </div>
                        </setting>
                    </block>

                    <block title="AI Extraction Prompts Configuration">
                        <setting id="extraction_prompts_setting" string="Configure AI Extraction Prompts">
                            <div class="d-flex gap-2">
                                <button string="Get Register Prompt" name="action_get_prompt_form_01" type="object" class="btn btn-outline-primary"/>
                                <button string="Get Report Prompt" name="action_get_prompt_form_02" type="object" class="btn btn-outline-primary"/>
                            </div>
                        </setting>
                    </block>

                    <block title="Google Drive Integration">
                        <setting id="gdrive_enabled_setting"
                                 help="Enable automatic fetching and processing of PDF files from Google Drive">
                            <field name="gdrive_enabled"/>
                            <div class="content-group">
                                <label for="gdrive_enabled" string="Enable Google Drive Integration"/>
                            </div>
                        </setting>

                        <setting id="gdrive_folder_id_setting"
                                 string="Google Drive Folder ID"
                                 help="The folder ID from which to fetch PDF files"
                                 invisible="not gdrive_enabled">
                            <field name="gdrive_folder_id" placeholder="1A2B3C4D5E6F7G8H9I0J" class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    You can find the folder ID in the URL: https://drive.google.com/drive/folders/<b>FOLDER_ID</b>
                                </div>
                            </div>
                        </setting>

                        <setting id="gdrive_credentials_json_setting"
                                 string="Service Account JSON"
                                 help="Google Cloud Service Account credentials in JSON format"
                                 invisible="not gdrive_enabled">
                            <field name="gdrive_credentials_json" placeholder='{"type": "service_account", "project_id": "...", ...}' class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    <ol>
                                        <li>Create a service account at <a href="https://console.cloud.google.com/iam-admin/serviceaccounts" target="_blank">Google Cloud Console</a></li>
                                        <li>Enable Google Drive API for your project</li>
                                        <li>Create and download the JSON key file</li>
                                        <li>Share your Google Drive folder with the service account email</li>
                                        <li>Paste the JSON content here</li>
                                    </ol>
                                </div>
                            </div>
                        </setting>

                        <setting id="gdrive_cron_interval_setting"
                                 string="Fetch Interval (minutes)"
                                 help="How often to check Google Drive for new files"
                                 invisible="not gdrive_enabled">
                            <field name="gdrive_cron_interval" class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    Default: 30 minutes. Both fetch and OCR cron jobs run at this interval.
                                </div>
                            </div>
                        </setting>

                        <setting id="gdrive_ocr_batch_size_setting"
                                 string="OCR Batch Size"
                                 help="Number of documents to process in each OCR run"
                                 invisible="not gdrive_enabled">
                            <field name="gdrive_ocr_batch_size" class="oe_inline"/>
                            <div class="content-group mt8">
                                <div class="text-muted">
                                    Default: 3 documents per run. Adjust based on your API limits and processing capacity.
                                </div>
                            </div>
                        </setting>
                    </block>
                </app>
            </xpath>
        </field>
    </record>
</odoo>
